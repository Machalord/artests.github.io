<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR AR Básico</title>
</head>
<body>
    <button id="startAR">Iniciar AR</button>
    <script>
        async function startAR() {
            if (navigator.xr) {
                try {
                    const session = await navigator.xr.requestSession("immersive-ar", {
                        requiredFeatures: ["hit-test"]
                    });

                    // Creamos un lienzo WebGL para el renderizado
                    const canvas = document.createElement("canvas");
                    document.body.appendChild(canvas);
                    const gl = canvas.getContext("webgl", { xrCompatible: true });

                    // Creamos el renderizador XR
                    const xrRefSpace = await session.requestReferenceSpace("local");
                    const viewerSpace = await session.requestReferenceSpace("viewer");
                    const hitTestSource = await session.requestHitTestSource({ space: viewerSpace });

                    const glLayer = new XRWebGLLayer(session, gl);
                    session.updateRenderState({ baseLayer: glLayer });

                    // Evento de renderizado
                    session.requestAnimationFrame((time, frame) => {
                        const pose = frame.getViewerPose(xrRefSpace);
                        if (pose) {
                            const hitTestResults = frame.getHitTestResults(hitTestSource);
                            if (hitTestResults.length > 0) {
                                const hitPose = hitTestResults[0].getPose(xrRefSpace);
                                console.log("Objeto debería aparecer en:", hitPose.transform.position);
                            }
                        }
                    });

                } catch (error) {
                    console.error("Error iniciando WebXR:", error);
                }
            } else {
                alert("WebXR no es compatible con este navegador.");
            }
        }

        document.getElementById("startAR").addEventListener("click", startAR);
    </script>
</body>
</html>
